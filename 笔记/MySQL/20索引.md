# 20 索引

```python
# 【一】索引的概念
# ● 索引（在MySQL中也叫做“键（key）”）是存储引擎用于快速找到记录的一种数据结构，这也是索引最基本的功能。
# ● 索引对于良好的性能非常关键。
#   ○ 数据量越大时，索引对性能的影响也越重要，好的索引可以将查询性能提高几个数量级。
#   ○ 在数据量较小且负载较低时，不恰当的索引对性能的影响可能还不明显，但是在数据量逐渐增大时，糟糕的索引会使MySQL的性能急剧的下降。
# ● 索引优化是查询性能优化最有效的手段。
# ● 如果想要在一本书中找到某个特定主题，一般会先看书的目录，找到对应的页码，然后直接翻到对应的页码即可查看。
#   ○ 在MySQL中，存储引擎用类似的方法使用索引
#     ■ 首先在索引中找到对应的值
#     ■ 然后根据匹配的索引记录找到对应的数据行。
# ● 简单的说，数据库索引类似于书前面的目录，能加快数据库的查询速度。

# 【二】MySQL中的索引类型
# 主键约束、唯一性约束、外键约束 ---> 这几个约束条件都会自动给对应的字段创建对应的索引

# 【三】索引操作
# 1.查看索引
'''
show index from 表名;
'''

# 2.创建索引
'''
create index 索引名字 on 表名(字段名);
'''
'''
create index index_name on emp(name);

mysql> create index index_name on emp(name);
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> show index from emp;
+-------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| Table | Non_unique | Key_name   | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |
+-------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| emp   |          0 | PRIMARY    |            1 | id          | A         |           6 |     NULL | NULL   |      | BTREE      |         |               |
| emp   |          1 | index_name |            1 | name        | A         |           6 |     NULL | NULL   | YES  | BTREE      |         |               |
+-------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
2 rows in set (0.00 sec)
'''

# 3.删除索引
'''
drop index 索引名 on 表名;
'''
'''
drop index index_name on emp;
mysql> drop index index_name on emp;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> show index from emp;
+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |
+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| emp   |          0 | PRIMARY  |            1 | id          | A         |           6 |     NULL | NULL   |      | BTREE      |         |               |
+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
1 row in set (0.00 sec)
'''

# 【四】索引的数据结构
# ● 对于索引的操作是非常简单的，但是关键在于我们要去学习支持索引的数据结构。
# ● 在数据结构那门课程里，我们可以使用二叉搜索树来加快查询，但是元素个数一多，对于输的高度就就会很高，而树高就代表着比较次数多，在实际项目中代表中I/O的访问次数多，因为数据库中的数据是存在硬盘里的。
# ● 或者我们还学过使用哈希表，他查询的时间复杂度为O(1)但是哈希表不支持范围查找，不支持模糊匹配。
# ● 实际上索引的背后使用的是B+树。
# ● 在了解B+树之前，先要了解B树，如果有考过 408 同学应该是对这个数据结构是非常熟悉的

# B+树
# （1）什么是B+树
# ● B+树是一种平衡查找树的数据结构，被广泛应用于数据库系统和文件系统中的索引结构。
# ● 它相比于其他树状结构（如二叉搜索树）具有更高的查询性能和更好的存储利用率。
# （2）B+树的特点
# ● 平衡性：B+树是一棵平衡树，即每个节点的左子树和右子树的高度差不超过1。这样可以保持树的高度相对较小，使得查找操作的复杂度保持在O(log n)级别。
# ● 多路搜索：B+树的每个内部节点可以拥有多个子节点，这使得B+树能够在每个节点上存储更多的关键字，提高了存储的效率。
# ● 顺序访问性：B+树的所有叶子节点按照关键字的大小顺序形成一个有序链表，可以支持范围查询和排序等操作。同时，由于内部节点只包含关键字而不包含具体数据，可以在内存中存放更多的节点，从而提高了缓存的命中率。
# ● 存储利用率高：B+树的内部节点不存储数据，只存储关键字，因此相比于其他树结构（如B树），B+树可以存储更多的关键字。这使得B+树在磁盘或内存中的存储利用率更高。
# （3）B+树的应用
# ● B+树的应用主要包括数据库系统和文件系统中的索引结构。
# ● 在数据库系统中，B+树常被用作数据库表的索引结构，能够高效地支持查找、插入、删除等操作。
# ● 在文件系统中，B+树常被用来维护文件的目录结构，可以快速定位和访问文件。
# （4）小结
# ● 总之，B+树是一种高效的数据结构，具有平衡性、多路搜索、顺序访问性和存储利用率高等特点，适用于需要高效查询和排序的场景。
# ● 只有叶子结点存放真实数据，根和树枝节点存的仅仅是虚拟数据
# ● 查询次数由树的层级决定，层级越低次数越少


# 【五】补充索引结构
# 1.聚集索引(主键索引) --- primary key
'''
create table test_one(
    id int primary key auto_increment,
    user_id int primary key auto_increment
);
-- ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key
'''
# ● 聚集索引（Clustered Index）是关系型数据库中的一种索引类型，它决定了表中数据的物理存储顺序。
# ● 在一个表中，只能有一个聚集索引。
# ● 聚集索引对表进行了重新组织，使得数据按照聚集索引的键值顺序存储在磁盘上。
# ● 由于聚集索引决定了数据的物理存储顺序，因此通过聚集索引可以快速地找到特定范围内的数据
# ● MySQL的聚簇索引是基于B+树的数据结构实现的，它会把数据存储在索引的叶子节点上，叶子节点之间按顺序链接，使得按主键进行搜索时速度最快。
# ● 如果没有主键，如果按主键搜索，速度是最快的。

# 聚簇索引的特点
# ● 数据的逻辑顺序和物理顺序是一致的，通过聚集索引可以直接访问特定行，因此   ----  聚集索引的查询速度很快。
# ● 聚集索引的键值必须是唯一的，不允许重复值存在。 --- unique + not null
# ● 当表中的数据发生插入、删除或更新操作时，聚集索引需要进行相应的调整以保持数据的有序性，这可能会对性能产生一定影响。 --- 调整主键自增起始位置
# ● 如果表中没有定义聚集索引，那么表的数据存储顺序将按照物理地址来存储。 --- 没有定义主键索引 B+ 数会自己选一个字段当索引
# ● 表不建立主键，也会有个隐藏字段是主键，是主键索引
# ● 主键索引对于按照主键进行查询的性能非常高。 --- 我们查询数据的时候都是根据主键ID差数据

# 2.辅助索引(普通索引)
# ● 辅助索引（Non-clustered Index）是关系型数据库中的一种索引类型，与聚集索引相对应。
# ● 辅助索引的键值并不决定数据在磁盘上的物理存储顺序，而是创建一个额外的数据结构来帮助加快查询速度。一个表可以有多个辅助索引。

# 辅助索引特点
# ● 辅助索引的建立并不直接影响数据的物理存储顺序，它是基于聚集索引（如果存在）或表本身的物理存储结构进行构建的。
# ● 辅助索引的键值可以重复，允许在同一个键值上有多行数据。
# ● 辅助索引存储着键值和指向实际数据行的指针，通过辅助索引可以快速定位到具体的数据行。
# ● 辅助索引的维护对数据的插入、删除、更新操作的性能有一定影响，因为每次操作都需要更新辅助索引。

'''
-- id 主键索引
select name from user where id=1;
-- 不仅有id还有 password password 辅助索引
select name from user where id=1 and password=666;
'''

# 3.唯一索引（unique）
# 唯一索引是指该索引的所有值都是唯一的，不允许出现重复值。

# 4.全文索引
# ● 全文索引是一种特殊的索引，它可以用来存储和检索文本数据。
# ● 全文索引可以包含单词、短语和其他类型的文本内容，并支持模糊匹配和近似匹配。
# CREATE FULLTEXT INDEX index_name ON table_name (column);
```

