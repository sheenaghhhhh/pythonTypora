# 17 存储过程

```python
# 【一】什么是存储过程
# 存储过程就类似于Python中的自定义函数
# 内部包含了一系列可以执行的SQL语句，存储过程存储在MySQL服务端中，可以通过调用存储过程触发内部的SQL语句
# ● 存储过程是在关系型数据库中存储的一组预定义的SQL语句集合，可以接收参数并返回结果。
#   ○ 它们被封装在数据库服务器中，并由应用程序通过调用存储过程来执行特定的数据库操作。
# 【二】存储过程的特点
# ● 预编译：
#   ○ 存储过程在首次创建时会被编译和优化，之后每次执行时都不需要再进行编译，这样可以提高数据库的执行效率。
# ● 数据库端执行：
#   ○ 与应用程序中直接执行SQL语句相比，存储过程在数据库服务器端执行，减少了网络传输开销，提高了数据访问性能。
# ● 代码重用：
#   ○ 存储过程可以被多个应用程序共享和重用，避免了重复编写相同的SQL语句，提高了开发效率。
# ● 安全性：
#   ○ 通过存储过程，可以将对数据库的访问权限限制在一定范围内，从而提高数据的安全性。
# ● 事务支持：
#   ○ 存储过程可以包含事务处理逻辑，保证数据库操作的一致性和完整性。
# ● 简化复杂操作：
#   ○ 存储过程可以执行复杂的数据操作和计算，简化了应用程序的开发和维护过程。

# 【二】使用存储过程
# 1.定义存储过程 -- 定义函数
'''
delimiter $$
create procedure 存储过程的名字(参数)
begin
    sql 语句;
end$$
delimiter ;
'''
# 2.调用存储过程
'''
call 存储过程的名字(参数);
'''

# 3.查看已经创建的存储过程的创建语句
'''
show create procedure 存储过程名字;
'''
# 4.查看所有的存储过程
'''
show procedure status;
'''

# 【三】存储过程的开发思路
# 1.提前定义好
# ● 应用程序
#   ○ 程序员写代码开发
# ● MySQL
#   ○ 提前编好存储过程，供应用程序调用
# ● 优点
#   ○ 开发效率提升、执行效率提升
# ● 缺点
#   ○ 考虑到人为因素、跨部门沟通等问题
#   ○ 后续的存储过程的扩展性差

# 2.第二种(自己动手写据库操作)
# ● 应用程序
#   ○ 程序员写代码开发之前
#   ○ 涉及到数据库操作需要自己动手写
# ● 优点
#   ○ 扩展性高
# ● 缺点
#   ○ 开发效率低
#   ○ 编写SQL语句繁琐，并且后续还需要考虑优化问题

# 3.第三种(ORM框架)
# ● 应用程序
#   ○ 只写程序代码
#   ○ 不写SQL语句
#   ○ 基于别人写好的操作MySQL的Python的框架直接调用即可(ORM框架)
# ● 优点
#   ○ 开发效率比上面的两种高
# ● 缺点
#   ○ 语句的扩展性差
#   ○ 可能会出现效率低下的问题

# 【四】演示
# 1.建表
'''
用员工表和部门表
'''


# 2.创建存储过程
def add(m: int) -> int:
    ...


# 查询 id >=3 并且 id <= 6 的员工数据
'''
select * from emp where id between 3 and 6;
'''
'''

create procedure search_info(
    -- in 入参参数 变量名 变量类型 === m: int
    in m int,
    n int
    -- out 返回值参数 返回值名字 返回值类型 === -> int
    -- out result int
)
begin 
    select * from emp where id between m and n;
end;

call search_info(1,4);

drop procedure search_info;

show procedure status;

show create procedure search_info;
'''
```

