# 16 事务

```python
# 【一】什么是事务
# ● 开启一个事务可以包含多条语句，这些语句要么同时成功，要么都不成功
# ● ****** 事务是指一系列相关操作的集合，这些操作被视为一个不可分割的工作单元 ******
# ● 事务的目标是确保在多个操作中的每一个都要么全部成功执行，要么全部失败回滚。
#   ○ 即事务的原子性

# 【二】事务的四大特性 ACID
# 1.原子性（Atomicity）
# ● 事务被视为一个原子操作，不可再分割。
# ● 要么所有的操作都成功执行，要么所有的操作都会被回滚到事务开始前的状态，确保数据的一致性。
# 2.一致性（Consistency）
# ● 事务执行前后，数据库应保持一致的状态。
# ● 在事务开始之前和结束之后，数据库必须满足所有的完整性约束，如数据类型、关系等。
# 3.隔离性（Isolation）
# ● 事务的执行结果对其他并发执行的事务是隔离的。
# ● 即一个事务的执行不应受到其他事务的干扰，各个事务之间应该相互独立工作，从而避免数据的不一致性。
# 4.持久性（Durability）
# ● 也叫永久性
# ● 一旦事务被提交，其结果应该永久保存在数据库中，并且可以被系统故障恢复。
# ● 即使系统发生宕机或崩溃，事务提交后的更改也应该是永久性的。

# 【三】事务的作用
# 1.数据一致性
# ● 事务可以确保数据库的一致性。
# ● 在一个事务中，要么所有的操作都成功执行，要么全部回滚，保证了数据的完整性和一致性。
# ● 例如，在一个转账操作中，如果转出账户扣款成功而转入账户未能成功接收资金，事务可以将操作全部回滚，以确保资金的一致性。
# 2.并发控制
# ● 事务提供了并发控制机制，确保多个并发执行的事务不会相互干扰，并避免数据的混乱和冲突。
# ● 通过隔离级别的设置，事务可以控制不同事务之间的可见性和影响范围，保证并发执行时的数据一致性和隔离性。
# 3.故障恢复
# ● 事务的持久性特性确保了在事务提交后，即使系统发生故障或崩溃，提交的结果仍然可以被恢复。
# ● 数据库管理系统通过使用日志文件等机制，将事务的操作记录下来，以便在需要时进行恢复和重放。
# 4.高效运行
# ● 通过组织多个操作为一个事务，可以减少与数据库交互的次数，从而提高数据库的操作效率和性能。事务可以减少磁盘I/O、锁的竞争等操作开销，提高数据库的并发处理能力。
# 5.数据完整性和安全性
# ● 事务可以保护数据的完整性和安全性。
# ● 通过在事务中定义一些条件和约束，可以确保数据的有效性和准确性。
# ● 例如，在一个银行系统中，事务可以检查账户余额是否足够以及转账金额是否合法，从而保证数据的安全性和正确性。

# 【四】事务的实际场景
# ● 检查库存：
#   ○ 系统需要检查所需商品的库存是否足够。
#   ○ 如果库存不足，系统会提示用户库存不足，无法完成订单。
# ● 扣减库存：
#   ○ 如果库存充足，系统会将所购商品对应的库存数量减少。
# ● 生成订单：
#   ○ 系统会生成一个新的订单，包括订单号、商品信息、购买数量、价格等相关信息。
# ● 计算总价：
#   ○ 根据订单中的商品信息和购买数量，系统会计算出订单的总价格。
# ● 更新用户账户：
#   ○ 根据用户选择的支付方式，在扣除相应金额后，系统会更新用户账户余额或积分。
# ● 生成支付信息：
#   ○ 系统会生成相应的支付信息，以便用户完成支付。
# ● 通知物流部门：
#   ○ 系统会通知物流部门准备配送相关商品。
# ● 发送订单确认邮件/短信：
#   ○ 系统会向用户发送订单确认的邮件或短信，包括订单详细信息、配送信息等。
# ● 监控商品配送：
#   ○ 系统会跟踪订单的配送情况，并向用户提供订单状态更新。
# ● 完成订单：
#   ○ 当用户收到商品并确认满意后，订单状态会被更新为“已完成”。

# 【五】操作事务
# 1.开启事务 : start transaction
# 2.提交事务 : commit
# 3.回滚事务 : rollback

# 【六】在Python中开启事务
import pymysql
# conn.commit()
# conn.cursor().execute("start transaction")
```



